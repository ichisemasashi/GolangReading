\section{Query for a single row}

このセクションでは、Goを使ってデータベースの1行を問い合わせます。

最大でも 1 行しか返さないことがわかっている SQL
文では、\texttt{QueryRow} を使用することができ、これは \texttt{Query}
ループを使用するよりも簡単です。

\textbf{コードを書く}

\begin{enumerate}
\item
  \texttt{albumsByArtist} の下に、以下の \texttt{albumByID}
  関数を貼り付けてください。
\begin{lstlisting}[numbers=none]
// albumByID queries for the album with the specified ID.
func albumByID(id int64) (Album, error) {
    // 返された行のデータを保持するためのalbum。
    var alb Album

    row := db.QueryRow("SELECT * FROM album WHERE id = ?", id)
    if err := row.Scan(&alb.ID, &alb.Title, &alb.Artist, &alb.Price);\\
       err != nil {
        if err == sql.ErrNoRows {
            return alb, fmt.Errorf("albumsById %d: no such album", id)
        }
        return alb, fmt.Errorf("albumsById %d: %v", id, err)
    }
    return alb, nil
}
\end{lstlisting}


  このコードでは

  \begin{itemize}
  \item
    \texttt{DB.QueryRow} を使用して \texttt{SELECT}
    文を実行し、指定された ID を持つアルバムを検索しています。

    これは、\texttt{sql.Row} を返します。呼び出し側のコード
    (あなたのコード!) を単純化するために、\texttt{QueryRow}
    はエラーを返さないようにします。その代わりに、後で
    \texttt{Rows.Scan} からクエリエラー (例えば \texttt{sql.ErrNoRows})
    を返せるようにします。
  \item
    カラムの値を構造体フィールドにコピーするには、\texttt{Row.Scan}
    を使用します。
  \item
    \texttt{Scan} からエラーが発生しないか確認してください。

    特別なエラー \texttt{sql.ErrNoRows}
    は、クエリが行を返さなかったことを意味します。通常、このエラーは、ここでは
    ``no such album''
    のような、より具体的なテキストに置き換える価値があります。
  \end{itemize}


\item
  \texttt{albumByID} を呼び出すように \texttt{main} を更新します。

  \texttt{func\ main} の最後に、以下のコードを追加します。

\begin{lstlisting}[numbers=none]
// ここでID 2をハードコードしてクエリをテストします。
alb, err := albumByID(2)
if err != nil {
    log.Fatal(err)
}
fmt.Printf("Album found: %v\n", alb)
\end{lstlisting}


  新しいコードでは、次のようになります。

  \begin{itemize}
  \item
    追加した \texttt{albumByID} 関数を呼び出す。
  \item
    返されたアルバムIDを表示する。
  \end{itemize}
\end{enumerate}

\textbf{コードの実行}

main.goのあるディレクトリのコマンドラインから、このコードを実行します。

\begin{lstlisting}[numbers=none]
$ go run .
Connected!
Albums found: [{1 Blue Train John Coltrane 56.99} \\
{2 Giant Steps John Coltrane 63.99}]
Album found: {2 Giant Steps John Coltrane 63.99}
\end{lstlisting}

次に、データベースにアルバムを追加します。

